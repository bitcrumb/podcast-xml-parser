<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Podcast XML Parser Demo</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css"
    />
  </head>

  <body class="bg-gray-800 text-gray-100 p-4">
    <h1 class="text-2xl font-bold mb-4">Podcast XML Parser</h1>
    <label for="urlInput" class="block mb-2">Enter Podcast XML URL:</label>
    <div class="flex items-center">
      <input
        type="url"
        id="urlInput"
        class="bg-gray-700 border-gray-500 min-w-max p-2 rounded border"
        value=""
      />
      <button
        onclick="parsePodcast()"
        class="ml-2 px-4 py-2 bg-blue-500 text-white rounded"
      >
        Parse
      </button>
      <button
        onclick="addPodcast()"
        class="ml-2 px-4 py-2 bg-gray-500 text-white rounded"
      >
        I'm lazy, just give me one
      </button>
    </div>

    <div class="hidden" id="podcast">
      <h2 class="text-xl font-bold mb-2 mt-4" id="podcastHeader">Podcast:</h2>
      <ul class="bg-gray-700 p-4 rounded" id="podcastInfo"></ul>
    </div>

    <div class="hidden" id="episodes">
      <h2 class="text-xl font-bold mb-2 mt-4" id="episodesHeader">
        Episodes: (<span></span>)
      </h2>
      <ul id="episodeList"></ul>
    </div>

    <div class="mt-4 hidden" id="loading">Loading...</div>

    <div class="mt-4 hidden" id="error"></div>

    <script src="./dist/bundle.js"></script>
    <script>
      document
        .getElementById("urlInput")
        .addEventListener("keyup", function (event) {
          if (event.key === "Enter" || event.keyCode === 13) {
            parsePodcast();
          }
        });

      function addPodcast() {
        document.getElementById("urlInput").value =
          "https://feeds.simplecast.com/dHoohVNH";
        parsePodcast();
      }

      async function parsePodcast() {
        document.getElementById("error").classList.add("hidden");
        document.getElementById("podcast").classList.add("hidden");
        document.getElementById("episodes").classList.add("hidden");
        document.getElementById("loading").classList.remove("hidden");
        const urlInput = document.getElementById("urlInput").value;

        try {
          const { podcast, episodes } = await podcastXmlParser(
            new URL(urlInput),
          );
          document.getElementById("podcast").classList.remove("hidden");
          document.getElementById("episodes").classList.remove("hidden");
          const episodesHeaderSpan = document.querySelector(
            "#episodesHeader > span",
          );
          if (episodesHeaderSpan) {
            episodesHeaderSpan.textContent = episodes.length.toString();
          }
          displayPodcastInfo(podcast);
          displayEpisodes(episodes);
        } catch (error) {
          console.error(error);
          document.getElementById("error").classList.remove("hidden");
          document.getElementById("error").textContent = error;
        } finally {
          document.getElementById("loading").classList.add("hidden");
        }
      }

      function displayPodcastInfo(podcast) {
        const infoList = document.getElementById("podcastInfo");
        infoList.innerHTML = ""; // Clear any existing podcast info

        for (let key in podcast) {
          const li = document.createElement("li");
          li.classList.add("mb-4", "pb-4", "border-b", "border-gray-500");

          const keyElement = document.createElement("span");
          keyElement.classList.add("bg-gray-600", "p-1", "rounded");
          keyElement.textContent = `${key}: `;
          li.appendChild(keyElement);

          const valueElement = document.createElement("pre");
          valueElement.classList.add("whitespace-normal", "mt-2");
          valueElement.textContent = JSON.stringify(podcast[key]);
          li.appendChild(valueElement);

          infoList.appendChild(li);
        }
      }

      function displayEpisodes(episodes) {
        const episodeList = document.getElementById("episodeList");
        episodeList.innerHTML = ""; // Clear any existing episodes

        episodes.forEach((episode, index) => {
          const li = document.createElement("li");
          li.classList.add("bg-gray-700", "p-4", "rounded", "mb-4");

          for (let key in episode) {
            const div = document.createElement("div");
            div.classList.add("mb-4", "pb-4", "border-b", "border-gray-500");

            const keyElement = document.createElement("span");
            keyElement.classList.add("bg-gray-600", "p-1", "rounded");
            keyElement.textContent = `${key}: `;
            div.appendChild(keyElement);

            const valueElement = document.createElement("pre");
            valueElement.classList.add("whitespace-normal", "mt-2");
            valueElement.textContent = JSON.stringify(episode[key]);
            div.appendChild(valueElement);

            li.appendChild(div);
          }

          episodeList.appendChild(li);
        });
      }
    </script>
  </body>
</html>
